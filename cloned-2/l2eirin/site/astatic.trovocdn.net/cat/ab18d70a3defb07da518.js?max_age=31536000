(window.webpackJsonp=window.webpackJsonp||[]).push([[1389],{548:function(e,t,n){e.exports=function(){"use strict";var e,t;function n(t){this.name="__st"+(1e9*Math.random()>>>0)+e+"__",null==t||t.forEach(this.add,this),e+=1}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{configurable:!0,writable:!0,value:function(e){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],o=0;o<n;){var r=t[o];if(e.call(i,r,o,t))return r;o+=1}}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return this.substring(t=!t||t<0?0:+t,t+e.length)===e}}),window.WeakSet||(e=Date.now()%1e9,n.prototype.add=function(e){var t=this.name;return e[t]||Object.defineProperty(e,t,{value:!0,writable:!0}),this},n.prototype.delete=function(e){return!!e[this.name]&&!(e[this.name]=void 0)},n.prototype.has=function(e){return!!e[this.name]},t=n,Object.defineProperty(window,"WeakSet",{value:function(e){return new t(e)}})),Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var t=Object(e),n=1;n<arguments.length;n++)if(null!=(i=arguments[n]))for(var i=Object(i),o=Object.keys(Object(i)),r=0,s=o.length;r<s;r++){var a=o[r],c=Object.getOwnPropertyDescriptor(i,a);null!=c&&c.enumerable&&(t[a]=i[a])}return t}});var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),o=0;for(t=0;t<n;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,o++)i[o]=r[s];return i}function c(e){try{return encodeURIComponent(decodeURIComponent(e))}catch(t){return e}}var l,g=(d.prototype.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n].callback===t)return n;return-1},d.prototype.on=function(e,t,n){if(void 0===n&&(n=0),this){var i=this.eventsList[e];return i||(this.eventsList[e]=[],i=this.eventsList[e]),-1!==this.indexOf(i,t)||i.push({name:e,type:n||0,callback:t}),this}},d.prototype.one=function(e,t){this.on(e,t,1)},d.prototype.remove=function(e,t){if(this){var n=this.eventsList[e];if(!n)return null;if(t)return n.length&&(t=this.indexOf(n,t),n.splice(t,1)),this;try{delete this.eventsList[e]}catch(e){}return null}},d.prototype.clear=function(){this.eventsList={}},d),f=function(e){return(e=Array.isArray(e)?e:[e]).map((function(e,t){return Object.getOwnPropertyNames(e).map((function(n){return c(n)+"["+t+"]="+(void 0===e[n]?"":c(e[n]))})).join("&")})).join("&")+(e.length?"&count="+e.length:"")};function d(){var s=this;this.emit=function(e,t){if(s){var n;if(null!=(i=s.eventsList[e])&&i.length)for(var i=i.slice(),o=0;o<i.length;o++){n=i[o];try{var r=n.callback.apply(s,[t]);if(1===n.type&&s.remove(e,n.callback),!1===r)break}catch(e){throw e}}return s}},this.eventsList={}}function s(e,t){return"number"==typeof e||"string"==typeof e?e:t?l.string:l.number}function h(e,t){return"string"==typeof e?e.split("?")[t?1:0]||"":e}function v(e){return"string"==typeof e&&e.startsWith("//")?"undefined"!=typeof location&&"https:"===location.protocol:/^https/.test(e)}function m(e){return a.some((function(t){return-1!==e.indexOf(t)}))}function y(e,t,n){var i;try{if("function"==typeof(null==t?void 0:t.retCodeHandler)){var o=t.retCodeHandler(e,null==n?void 0:n.url,null==n?void 0:n.ctx)||{};return{code:void 0===(r=o.code)?"unknown":r,isErr:o.isErr}}"string"==typeof e&&(e=JSON.parse(e)),"function"==typeof(null===(i=null==t?void 0:t.ret)||void 0===i?void 0:i.join)&&(O=[].concat(t.ret.map((function(e){return e.toLowerCase()}))));var r,s=Object.getOwnPropertyNames(e).filter((function(e){return-1!==O.indexOf(e.toLowerCase())}));return s.length?{code:""+(r=Number(e[s[0]])),isErr:0!==r}:{code:"unknown",isErr:!1}}catch(e){return{code:"unknown",isErr:!1}}}function w(e,s){void 0===s&&(s=3);var t,a,n,u="";return Array.isArray(e)?(u+="[",t=e.length,e.forEach((function(e,n){var o,i;u+="object"==typeof e&&1<s?w(e,s-1):(i="",i+="undefined"==(e=typeof(o=e))||"symbol"==e||"function"==e?"null":"string"==e||"object"==e?'"'+o+'"':o),u+=n===t-1?"":","})),u+="]"):e instanceof Object?(u="{",a=Object.keys(e),n=a.length,a.forEach((function(t,o){var r,i,c;"object"==typeof e[t]&&1<s?u+='"'+t+'":'+w(e[t],s-1):u+=(c="","string"==(t=typeof(i=e[r=t]))||"object"==t?c+='"'+r+'":"'+i+'"':"function"==typeof i?c+='"'+r+'":"function '+i.name+'"':"symbol"==typeof i?c+='"'+r+'":"symbol"':"number"!=typeof i&&"boolean"!=t||(c+='"'+r+'": '+i),c),u+=o===n-1||o<n-1&&void 0===e[a[o+1]]?"":","})),u+="}"):u+=e,u}(qe=l=l||{})[qe.number=-1]="number",qe.string="";var E,R,u,a=["application/octet-stream","application/xhtml+xml","application/xml","application/pdf","application/pkcs12","application/javascript","application/ecmascript","application/vnd.mspowerpoint","application/ogg","text/html","text/css","text/javascript","image","audio","video"],O=["ret","retcode","code","errcode"],T=function(e){if("string"==typeof e)return e;try{return(JSON.stringify(e,(i=[],t=[],function(e,n){if(n instanceof Error)return"Error.message: "+n.message+" \n  Error.stack: "+n.stack;if("object"==typeof n&&null!==n){var o=i.indexOf(n);if(-1!==o)return"[Circular "+t[o]+"]";i.push(n),t.push(e||"root")}return n}),4)||"undefined").replace(/"/gim,"")}catch(e){return"error happen when aegis stringify: \n "+e.message+" \n "+e.stack}var i,t},b=(L.prototype.sourceURL=function(){return this.data.responseURL},L.prototype.status=function(){return Number(this.data.status)},L.prototype.headers=function(){var e=this.data.getAllResponseHeaders().split("\n"),t={};return e.forEach((function(e){var n;e&&(e=(n=e.split(": "))[0],n=n[1].trim(),t[e]=n)})),t},L),p=(S.prototype.sourceURL=function(){return this.data.url},S.prototype.status=function(){return Number(this.data.status)},S.prototype.headers=function(){var e={};return this.data.headers.forEach((function(t,n){e[n]=t})),e},S);function S(e,t){this.type="fetch",this.data=e||{},this.data.response=t}function L(e){this.type="xhr",this.data=e}function P(e,t){var i,n=[],o=e.config;return e.lifeCycle.on("destroy",(function(){n.length=0})),function(e,r){if(n.push(e),t&&n.length>=t)return n=F(n),r(n.splice(0,n.length)),void(i&&clearTimeout(i));i&&clearTimeout(i),i=setTimeout((function(){i=null,0<(n=F(n)).length&&r(n.splice(0,n.length))}),o.delay)}}function x(e,t){return Array.isArray(e)?t(e.map((function(e){return o(o({},e),{msg:"string"==typeof e.msg?e.msg:[].concat(e.msg).map(T).join(" ")})}))):t(o(o({},e),{msg:"string"==typeof e.msg?e.msg:T(e.msg)}))}function C(e){return function(t,n){e.lifeCycle.emit("modifyRequest",t);var o=e.config.modifyRequest;if("function"==typeof o)try{var i=o(t);"object"==typeof i&&"url"in i&&(t=i)}catch(t){console.error(t)}n(t)}}function I(i){return function(e,t){i.lifeCycle.emit("afterRequest",e);var n=i.config.afterRequest;"function"==typeof n&&!1===n(e)||t(e)}}function A(e){if(!e||!e.reduce||!e.length)throw new TypeError("createPipeline need at least one function param");return 1===e.length?function(t,n){e[0](t,n||M)}:e.reduce((function(e,i){return function(t,n){return void 0===n&&(n=M),e(t,(function(e){return null==i?void 0:i(e,n)}))}}))}function N(e,t){Object.getOwnPropertyNames(e).forEach((function(n){"function"==typeof e[n]&&"constructor"!==n&&(t?t[n]="sendPipeline"===n?function(){return function(){}}:function(){}:e[n]=function(){})}))}function k(){return void 0!==window.performance&&"function"==typeof performance.clearResourceTimings&&"function"==typeof performance.getEntriesByType&&"function"==typeof performance.now}function _(e){if(K.find((function(t){return t.name===e.name})))throw new Error("name '"+e.name+"' is already in hackXHR option list");var t,i;K.push(e),!$&&window.XMLHttpRequest&&($=!0,t=window.XMLHttpRequest.prototype.send,i=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(){if(this.aegisMethod=arguments[0],this.aegisUrl=arguments[1],this.aegisXhrStartTime=Date.now(),!this.sendByAegis)for(var e=0;e<K.length;e++){var t=K[e];try{"function"==typeof t.open&&t.open(this)}catch(e){}}return i.apply(this,arguments)},window.XMLHttpRequest.prototype.send=function(){if(!this.sendByAegis)for(var e=0;e<K.length;e++){var n=K[e];try{"function"==typeof n.send&&n.send(this,arguments[0])}catch(e){}}return t.apply(this,arguments)})}function U(e){var t=K.findIndex((function(t){return t.name===e.name}));-1!==t&&K.splice(t,1)}(le=E=E||{}).INFO_ALL="-1",le.API_RESPONSE="1",le.INFO="2",le.ERROR="4",le.PROMISE_ERROR="8",le.AJAX_ERROR="16",le.SCRIPT_ERROR="32",le.IMAGE_ERROR="64",le.CSS_ERROR="128",le.CONSOLE_ERROR="256",le.MEDIA_ERROR="512",le.RET_ERROR="1024",le.REPORT="2048",le.PV="4096",le.EVENT="8192",le.PAGE_NOT_FOUND_ERROR="16384",(pe=R=R||{}).LOG="log",pe.SPEED="speed",pe.PERFORMANCE="performance",pe.OFFLINE="offline",pe.WHITE_LIST="whiteList",pe.VITALS="vitals",pe.PV="pv",pe.CUSTOM_PV="customPV",pe.EVENT="event",pe.CUSTOM="custom",pe.SDK_ERROR="sdkError",pe.SET_DATA="setData",(ge=u=u||{}).production="production",ge.gray="gray",ge.pre="pre",ge.daily="daily",ge.local="local",ge.test="test",ge.others="others";var j,q,F=function(e){return e.filter((function(t,i){return"static"!==t.type||!e.find((function(e,n){return i!==n&&t.url===e.url&&200===t.status}))}))},D=function(e){e.level===E.INFO_ALL&&(e.level=E.INFO)},H=function(i){return function(e){return i.sendPipeline([function(e,t){return t({url:i.config.url||"",data:f(e),method:"post",contentType:"application/x-www-form-urlencoded",type:R.LOG,log:e,requestConfig:{timeout:5e3},success:function(){var n=i.config.onReport;"function"==typeof n&&e.forEach((function(e){n(e)})),"function"==typeof t&&t([])},fail:function(e){"403 forbidden"===e&&i.destroy()}})}],R.LOG)(e)}},M=function(){},B=(Object.defineProperty(ee.prototype,"__version__",{get:function(){return console.warn("__version__ has discard, please use version"),"1.35.18"},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"LogType",{get:function(){return console.warn("LogType has discard, please use logType"),E},enumerable:!1,configurable:!0}),ee.prototype.init=function(e){this.setConfig(e);for(var t=0;t<ee.installedPlugins.length;t++)try{ee.installedPlugins[t].patch(this)}catch(e){this.sendSDKError(e)}this.lifeCycle.emit("onInited")},ee.prototype.setConfig=function(e){Object.assign(this.config,e);var t=(c=this.config).id,i=c.uin,n=c.version,o=c.ext1,s=c.ext2,a=c.ext3,r=(e=c.aid,void 0===(c=c.env)?"production":c),c=this.bean.id!==t||this.bean.uin!==i||this.bean.aid!==e;return this.bean.id=t||"",this.bean.uin=i||"",this.bean.version=n||"1.35.18",this.bean.aid=e||"",this.bean.env=function(){switch(r){case u.production:case u.gray:case u.pre:case u.daily:case u.local:case u.test:case u.others:return 1;default:return}}()?r:u.others,o&&(this.bean.ext1=encodeURIComponent(o)),s&&(this.bean.ext2=encodeURIComponent(s)),a&&(this.bean.ext3=encodeURIComponent(a)),c&&this.lifeCycle.emit("onConfigChange",this.config),this.config},ee.use=function(e){-1===ee.installedPlugins.indexOf(e)&&e.aegisPlugin&&ee.installedPlugins.push(e)},ee.unuse=function(e){-1!==(e=ee.installedPlugins.indexOf(e))&&ee.installedPlugins.splice(e,1)},ee.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:E.INFO,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:E.INFO}),this.normalLogPipeline(n)},ee.prototype.infoAll=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:E.INFO_ALL,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:E.INFO_ALL}),this.normalLogPipeline(n)},ee.prototype.report=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:E.REPORT,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0])),this.normalLogPipeline(n)},ee.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={level:E.ERROR,msg:e};1===e.length&&e[0].msg&&Object.assign(n,o({},e[0]),{level:E.ERROR}),this.normalLogPipeline(n)},ee.prototype.speedLogPipeline=function(e){throw new Error('You need to override "speedLogPipeline" method')},ee.prototype.reportPv=function(e){var i,t=this;e&&(console.warn("reportPv is deprecated, please use reportEvent"),i=""+Object.getOwnPropertyNames(this.bean).filter((function(e){return"id"!==e})).map((function(e){return e+"="+t.bean[e]})).join("&"),this.sendPipeline([function(n,o){o({url:t.config.url+"/"+e+"?"+i,addBean:!1,type:R.CUSTOM_PV,fail:function(e){"403 forbidden"===e&&t.destroy()}})}],R.CUSTOM_PV)(null))},ee.prototype.reportEvent=function(e){e&&((e="string"==typeof e?{name:e,ext1:this.config.ext1||"",ext2:this.config.ext2||"",ext3:this.config.ext3||""}:e).name?this.eventPipeline(e):console.warn("reportEvent params error"))},ee.prototype.reportTime=function(e,t){if("object"==typeof e)return this.reportT(e);"string"==typeof e?"number"==typeof t?t<0||6e4<t?console.warn("reportTime: duration must between 0 and 60000"):this.submitCustomTime(e,t):console.warn("reportTime: second param must be number"):console.warn("reportTime: first param must be a string")},ee.prototype.reportT=function(e){var t=e.name,n=e.duration,o=void 0===(i=e.ext1)?"":i,i=void 0===(r=e.ext2)?"":r,r=void 0===(r=e.ext3)?"":r;if(e=e.from,"string"==typeof t&&"number"==typeof n&&"string"==typeof o&&"string"==typeof i&&"string"==typeof r){if(!(n<0||6e4<n))return this.submitCustomTime(t,n,o,i,r,void 0===e?"":e);console.warn("reportTime: duration must between 0 and 60000")}else console.warn("reportTime: params error")},ee.prototype.time=function(e){"string"==typeof e?this.timeMap[e]?console.warn("Timer "+e+" already exists"):this.timeMap[e]=Date.now():console.warn("time: first param must be a string")},ee.prototype.timeEnd=function(e){"string"==typeof e?this.timeMap[e]?(this.submitCustomTime(e,Date.now()-this.timeMap[e]),delete this.timeMap[e]):console.warn("Timer "+e+" does not exist"):console.warn("timeEnd: first param must be a string")},ee.prototype.submitCustomTime=function(e,t,n,i,o,r){this.customTimePipeline({name:e,duration:t,ext1:n||this.config.ext1,ext2:i||this.config.ext2,ext3:o||this.config.ext3,from:r||void 0})},ee.prototype.extendBean=function(e,t){this.bean[e]=t},ee.prototype.sendPipeline=function(e,t){var n,c,s,a=this;return A(r([function(e,t){if("number"!=typeof n.config.random&&(console.warn("random must in [0, 1], default is 1."),n.config.random=1),!n.isHidden||!n.isGetSample)if(n.isGetSample)n.isHidden||t(e);else{if(n.isGetSample=!0,Math.random()<n.config.random)return n.isHidden=!1,t(e);n.isHidden=!0}},(s=t,function(e,t){var n=Array.isArray(e),i=n?e:[e];c.lifeCycle.emit("beforeRequest",e);var r=c.config.beforeRequest;(i="function"==typeof r?i.map((function(e){try{var t=r({logs:e,logType:s});return(null==t?void 0:t.logType)===s&&null!=t&&t.logs?t.logs:!1!==t&&e}catch(t){return e}})).filter((function(e){return!1!==e})):i).length&&(i=function(e,t){if(!Array.isArray(e)||e.length<=1)return e;var n=[],i=[];return!(i="string"==typeof t?[t]:t)||i.length<=0||(i.forEach((function(t){e.forEach((function(e){null!=e&&e[t]&&n.push(t)}))})),0<n.length&&(e=e.map((function(e){var t={};return n.forEach((function(e){t[e]=""})),o(o({},t),e)})))),e}(i,["ext1","ext2","ext3"]),t(n?i:i[0]))})],e,[C(c=n=this),function(i,e){a.request(i,(function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];e({isErr:!1,result:n,logType:null==i?void 0:i.type,logs:null==i?void 0:i.log}),null===(t=null==i?void 0:i.success)||void 0===t||t.call.apply(t,r([i],n))}),(function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];e({isErr:!0,result:n,logType:null==i?void 0:i.type,logs:null==i?void 0:i.log}),null===(t=null==i?void 0:i.fail)||void 0===t||t.call.apply(t,r([i],n))}))},I(this)]))},ee.prototype.send=function(e,t,n){var o=this;return A([C(this),function(e,i){o.request(e,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];i({isErr:!1,result:n,logType:e.type,logs:e.log}),null==t||t.apply(void 0,n)}),(function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];i({isErr:!0,result:t,logType:e.type,logs:e.log}),null==n||n.apply(void 0,t)}))},I(this)])(e)},ee.prototype.request=function(e,t,n){throw new Error('You need to override "request" method')},ee.prototype.sendSDKError=function(e){var t=this;this.sendPipeline([function(e,n){n({url:t.config.url+"?id=1085&msg[0]="+encodeURIComponent(T(e))+"&level[0]=2&from="+t.config.id+"&count=1&version="+t.config.id+"(1.35.18)",addBean:!1,method:"get",type:R.SDK_ERROR,log:e})}],R.SDK_ERROR)(e)},ee.prototype.destroy=function(e){void 0===e&&(e=!1);var t,n,i=ee.instances.indexOf(this);-1!==i&&ee.instances.splice(i,1);for(var o=ee.installedPlugins.length-1;0<=o;o--)try{ee.installedPlugins[o].unpatch(this)}catch(e){this.sendSDKError(e)}if(this.lifeCycle.emit("destroy"),this.lifeCycle.clear(),e)t=this,n=Object.getOwnPropertyDescriptors(t),Object.keys(n).forEach((function(e){n[e].writable&&(t[e]=null)})),Object.setPrototypeOf(this,null);else{for(var r=this;r.constructor!==Object&&N(r,this),r=Object.getPrototypeOf(r););0===ee.instances.length&&(N(e=Object.getPrototypeOf(this).constructor),N(ee))}},ee.version="1.35.18",ee.instances=[],ee.logType=E,ee.environment=u,ee.installedPlugins=[],ee),V=(Z.prototype.patch=function(e){this.canUse(e)&&this.exist(e)&&(this.instances.push(e),this.triggerInit(e),this.triggerOnNewAegis(e))},Z.prototype.unpatch=function(e){-1!==(e=this.instances.indexOf(e))&&this.instances.splice(e,1)},Z.prototype.countInstance=function(){return this.instances.length},Z.prototype.uninstall=function(){var e;null===(e=null===(e=this.option)||void 0===e?void 0:e.destroy)||void 0===e||e.apply(this)},Z.prototype.walk=function(e){var i=this;this.instances.forEach((function(t){var n=i.canUse(t);n&&e(t,n)}))},Z.prototype.canUse=function(e){return!(!(e=this.getConfig(e))||"object"!=typeof e)||!!e},Z.prototype.getConfig=function(e){return null===(e=e.config)||void 0===e?void 0:e[this.name]},Z.prototype.exist=function(e){return-1===this.instances.indexOf(e)},Z.prototype.triggerInit=function(e){var t;this.inited||(this.inited=!0,null===(t=null===(t=this.option)||void 0===t?void 0:t.init)||void 0===t||t.call(this.option,this.getConfig(e)))},Z.prototype.triggerOnNewAegis=function(e){var t;null===(t=null===(t=this.option)||void 0===t?void 0:t.onNewAegis)||void 0===t||t.call(this.option,e,this.getConfig(e))},Z),W=new V({name:"aid",aid:"",init:function(e){try{var t=!0!==e&&e||window.localStorage.getItem("AEGIS_ID");t||(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),window.localStorage.setItem("AEGIS_ID",t)),this.aid=t}catch(e){}},onNewAegis:function(e){e.bean.aid=this.aid,e.config.aid=this.aid}}),X=function(e){if(e.payload){var t={};return Object.keys(e).forEach((function(n){"payload"!==n&&(t[n]=e[n])})),t}return e},G=new V({name:"reportAssetSpeed"}),J=G=new V({name:"reportAssetSpeed",collectCur:0,ASSETS_INITIATOR_TYPE:["img","css","script","link","audio","video"],onNewAegis:function(e){var t=this;k()&&(this.collectSuccessLog(e),this.collectFailLog(e),performance.onresourcetimingbufferfull=function(){t.collectCur=0,performance.clearResourceTimings()})},publish:function(e){this.$walk((function(t){t.speedLogPipeline(e)}))},collectSuccessLog:function(e){function t(e){for(var t=0,n=e.length;t<n;t++){var i=e[t];-1!==o.ASSETS_INITIATOR_TYPE.indexOf(i.initiatorType)&&-1===i.name.indexOf("cdn-go.cn/aegis/aegis-sdk")&&o.publish(o.generateLog(i,r))}}var n,i,o=this,r=e.config;"function"==typeof window.PerformanceObserver?(t(performance.getEntriesByType("resource")),(n=new window.PerformanceObserver((function(e){t(e.getEntries())}))).observe({entryTypes:["resource"]}),e.lifeCycle.on("destroy",(function(){0===G.countInstance()&&n.disconnect()}))):(i=setInterval((function(){var e=performance.getEntriesByType("resource"),n=e.slice(o.collectCur);o.collectCur=e.length,t(n)}),3e3),e.lifeCycle.on("destroy",(function(){0===G.countInstance()&&clearInterval(i)})))},collectFailLog:function(e){function t(e){var t,o;e&&(e=e.target||e.srcElement,t=(null==e?void 0:e.src)||(null==e?void 0:e.href),e=null==e?void 0:e.tagName,t&&"string"==typeof t&&("IMG"===e&&-1<window.location.href.indexOf(t)||(e="function"==typeof(null===(e=n.api)||void 0===e?void 0:e.resourceTypeHandler)?null===(o=n.api)||void 0===o?void 0:o.resourceTypeHandler(t):"",o=performance.getEntriesByType("resource").find((function(e){return e.name===t})),e={url:h(t),status:400,duration:Number(((null==o?void 0:o.duration)||0).toFixed(2)),method:"get",type:e||"static",isHttps:v(t),urlQuery:h(t,!0),domainLookup:0,connectTime:0},i.publish(e))))}var i=this,n=e.config;window.document.addEventListener("error",t,!0),e.lifeCycle.on("destroy",(function(){0===G.countInstance()&&window.document.removeEventListener("error",t,!0)}))},generateLog:function(e,t){var n,i="function"==typeof(null===(n=t.api)||void 0===n?void 0:n.resourceTypeHandler)?null===(i=t.api)||void 0===i?void 0:i.resourceTypeHandler(e.name):"";return{url:h(e.name),method:"get",duration:Number(e.duration.toFixed(2)),status:200,type:i||"static",isHttps:v(e.name),urlQuery:h(e.name,!0),domainLookup:s(e.domainLookupEnd-e.domainLookupStart),connectTime:s(e.connectEnd-e.connectStart)}},destroy:function(){this.option.publish=function(){}}}),$=!1,K=[],Q=!1,Y=[],z=(new V({name:"reportApiSpeed"}),new V({name:"reportApiSpeed",override:!1,onNewAegis:function(e){this.override||(this.override=!0,this.overrideFetch(e.config),this.overrideXhr(e.config))},overrideFetch:function(e){var t=this,n={name:this.name,then:function(n,s,a,o){var r,u,c,f;e.hostUrl&&-1<a.indexOf(e.hostUrl)||(u={url:n.url,isHttps:v(n.url),method:(null==o?void 0:o.method)||"get",duration:s,type:"fetch",status:n.status||0},"fetch"!==(f="function"==typeof(null===(r=e.api)||void 0===r?void 0:r.resourceTypeHandler)?null===(c=e.api)||void 0===c?void 0:c.resourceTypeHandler(n.url):f)&&"static"!==f&&(c=n.headers?n.headers.get("content-type"):"",f=n.ok&&"string"==typeof c&&m(c)?"static":"fetch"),"fetch"===f?n.clone().text().then((function(r){var c=null===(f=e.api)||void 0===f?void 0:f.apiDetail,l=n.status<=0||400<=n.status,f=(i=y(r,e.api,{url:a,ctx:n})).code,i=i.isErr;c=(l?"FETCH_ERROR: "+r+" \n\n":"")+"req url: "+a+" \n                                \nreq method: "+((null==o?void 0:o.method)||"get")+" \n                                \nreq param: "+(c?w(null==o?void 0:o.body):"")+" \n                                \nres duration: "+s+" \n                                \nres status: "+(n.status||0)+" \n                                \nres retcode: "+f+"\n                                \nres data: "+(c?r:""),u.payload=new p(n,r),u.ret=f,u.isErr=+i,t.publishNormalLog({msg:c,level:l?E.AJAX_ERROR:i?E.RET_ERROR:E.API_RESPONSE,code:f})})):Object.assign(u,{type:"static",urlQuery:h(n.url,!0),domainLookup:l.number,connectTime:l.number}),t.publishSpeed(u))},catch:function(n,o,r,i){if(!(e.hostUrl&&-1<r.indexOf(e.hostUrl))){var c={url:r,isHttps:v(r),method:(null==i?void 0:i.method)||"get",duration:o,type:"fetch",status:0};throw t.publishSpeed(c),c=null===(c=e.api)||void 0===c?void 0:c.apiDetail,i="AJAX_ERROR: "+n+"\n                          \nres status: 0\n                          \nres duration: "+o+"\n                          \nreq url: "+r+"\n                          \nreq method: "+((null==i?void 0:i.method)||"get")+"\n                          \nreq param: "+(c?w(null==i?void 0:i.body):""),t.publishNormalLog({msg:i,level:E.AJAX_ERROR,code:-400}),n}}};this.hackFetchOptions=n,function(e){if(Y.find((function(t){return t.name===e.name})))throw new Error("name '"+e.name+"' is already in hackFetch option list");var s;Y.push(e),!Q&&window.fetch&&(Q=!0,s=window.fetch,window.fetch=function(e,i){void 0===i&&(i={});for(var t="string"==typeof e?e:e.url,n=0;n<Y.length;n++){var o=Y[n];try{"function"==typeof o.beforeFetch&&o.beforeFetch(t,i)}catch(e){}}var r=Date.now();return s(e,i).then((function(e){for(var n=0;n<Y.length;n++){var o=Y[n];try{"function"==typeof o.then&&o.then(e,Date.now()-r,t,i)}catch(e){}}return e})).catch((function(e){for(var n=0;n<Y.length;n++){var o=Y[n];try{"function"==typeof o.catch&&o.catch(e,Date.now()-r,t,i)}catch(e){}}throw e}))})}(this.hackFetchOptions)},getRequestType:function(e,t,n){var i,o="function"==typeof(null===(i=e.api)||void 0===i?void 0:i.resourceTypeHandler)?null===(o=e.api)||void 0===o?void 0:o.resourceTypeHandler(n):"";return"fetch"!==o&&"static"!==o&&(n=t.getResponseHeader("content-type"),o=400<=t.status||"string"!=typeof n||!m(n)?"fetch":"static"),o},overrideXhr:function(e){var p=this,t={name:this.name,send:function(u,t){var n=Date.now();u.addEventListener("loadend",(function(){var o,r=u.aegisUrl;if(r){var c=Date.now()-n,i={url:r,isHttps:v(r),status:u.status||0,method:u.aegisMethod||"get",type:"fetch",duration:c,payload:new b(u)};if("fetch"===p.getRequestType(e,u,r))try{var f=null===(o=e.api)||void 0===o?void 0:o.apiDetail,d=y(u.response,e.api,{url:r,ctx:u}),s=d.code,a=d.isErr,m="req url: "+r+" \n                                \nreq method: "+i.method+" \n                                \nreq param: "+(f?w(t):"")+" \n                                \nres duration: "+c+" \n                                \nres status: "+i.status+" \n                                \nres retcode: "+s+"\n                                \nres data: "+(f?w(u.response):"");i.ret=s,i.isErr=+a,p.publishNormalLog({msg:m,level:a?E.RET_ERROR:E.API_RESPONSE,code:s})}catch(o){i.ret="unknown"}else Object.assign(i,{type:"static",urlQuery:h(r,!0),domainLookup:l.number,connectTime:l.number});p.publishSpeed(i)}}))}};this.hackXHROptions=t,_(this.hackXHROptions)},publishSpeed:function(e){var i=this;e.url=h(e.url),this.$walk((function(t){var n=i.$getConfig(t);"fetch"===e.type&&n&&"function"==typeof n.urlHandler?t.speedLogPipeline(o(o({},e),{url:encodeURIComponent(n.urlHandler(e.url,e.payload))})):t.speedLogPipeline(e)}))},publishNormalLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){var e,t;this.option.publishSpeed=function(){},this.option.publishNormalLog=function(){},this.option.hackXHROptions&&U(this.option.hackXHROptions),this.option.hackFetchOptions&&(e=this.option.hackFetchOptions,-1!==(t=Y.findIndex((function(t){return t.name===e.name})))&&Y.splice(t,1))}}));function Z(e){this.aegisPlugin=!0,this.name="",this.instances=[],this.inited=!1,e.$walk=this.walk.bind(this),e.$getConfig=this.getConfig.bind(this),this.option=e,this.name=e.name}function ee(e){var t,n,s,i,a,o,r,u,c,l,f,d,p,h=this;this.isGetSample=!1,this.isHidden=!1,this.config={version:0,delay:1e3,onError:!0,repeat:5,random:1,aid:!0,device:!0,pagePerformance:!0,webVitals:!0,speedSample:!0,hostUrl:"https://aegis.qq.com",env:"production",url:"",offlineUrl:"",whiteListUrl:"",pvUrl:"",speedUrl:"",customTimeUrl:"",performanceUrl:"",webVitalsUrl:"",eventUrl:""},this.isWhiteList=!1,this.lifeCycle=new g,this.bean={},this.normalLogPipeline=A([P(this,5),x,(t=this,function(e,n){var i=t.config;n(e=e.map((function(e){var t,n=i.maxLength||204800;try{if(!e.msg||e.msg.length<=n)return e;e.msg=null===(t=e.msg)||void 0===t?void 0:t.substring(0,n)}catch(t){e.msg=T(e.msg).substring(0,i.maxLength)}return e})))}),(d=this.config,p={},function(e,t){var n="number"==typeof d.repeat?d.repeat:5;if(0===n)return t(e);t(e.filter((function(e){return e.level!==E.ERROR&&e.level!==E.PROMISE_ERROR&&e.level!==E.AJAX_ERROR&&e.level!==E.SCRIPT_ERROR&&e.level!==E.IMAGE_ERROR&&e.level!==E.CSS_ERROR&&e.level!==E.MEDIA_ERROR||(p[e.msg]=p[e.msg]||0,p[e.msg]+=1,!(p[e.msg]>n))})))}),(l=this.lifeCycle.emit,f=this.config,function(e,t){var n=f.logCreated;return"function"!=typeof n?(l("beforeWrite",e),t(e)):(e=e.filter((function(e){return!1!==n(e)})),l("beforeWrite",e),t(e))}),(c=this,setTimeout((function(){var e=c.config.pvUrl,t=void 0===e?"":e;t&&c.sendPipeline([function(e,n){n({url:t,type:R.PV,fail:function(e){"403 forbidden"===e&&c.destroy()}})}],R.PV)(null)}),100),function(e,t){t(e)}),(r=o=a=!1,u=[],(s=this).lifeCycle.on("onConfigChange",(function(){i&&clearTimeout(i),i=setTimeout((function(){var e,t;!r&&s.config&&(r=!0,e=s.config.whiteListUrl,(t=void 0===e?"":e)&&s.sendPipeline([function(e,n){n({url:t,type:R.WHITE_LIST,success:function(e){o=!0;try{var t=e.data||JSON.parse(e),n=t.retcode,i=t.result,r=void 0===i?{}:i;if(0===n){if(a=r.is_in_white_list,s.isWhiteList=a,r.shutdown)return void s.destroy();0<=r.rate&&r.rate<=1&&(s.config.random=r.rate,s.isGetSample=!1)}s.isWhiteList&&u.length?H(s)(u.splice(0),(function(){})):!s.isWhiteList&&u.length&&(u.length=0);var c=s.config.onWhitelist;"function"==typeof c&&c(a)}catch(e){}},fail:function(e){"403 forbidden"===e&&s.destroy(),o=!0}})}],R.WHITE_LIST)(null),r=!1)}),s.config.uin?50:500)})),s.lifeCycle.on("destroy",(function(){u.length=0})),function(e,t){var n;a||null!==(n=null===(n=s.config)||void 0===n?void 0:n.api)&&void 0!==n&&n.reportRequest?t(e.concat(u.splice(0)).map((function(e){return D(e),e}))):(e=e.filter((function(e){return e.level!==E.INFO&&e.level!==E.API_RESPONSE?(D(e),!0):(o||(u.push(e),200<=u.length&&(u.length=200)),!1)}))).length&&t(e)}),function(e,t){var n=JSON.parse(JSON.stringify(e));h.lifeCycle.emit("beforeReport",n);var i=h.config.beforeReport;(e="function"==typeof i?e.filter((function(e){return!1!==i(e)})):e).length&&t(e)},H(this)]),this.eventPipeline=A([P(this,5),function(e){h.sendPipeline([function(e,t){var n=e.map((function(e){return{name:e.name,ext1:e.ext1||h.config.ext1||"",ext2:e.ext2||h.config.ext2||"",ext3:e.ext3||h.config.ext3||""}}));t({url:h.config.eventUrl+"?payload="+encodeURIComponent(JSON.stringify(n)),type:R.EVENT,log:e,fail:function(e){"403 forbidden"===e&&h.destroy()}})}],R.EVENT)(e)}]),this.timeMap={},this.customTimePipeline=A([P(this,5),function(e){return h.sendPipeline([function(e,t){t({url:h.config.customTimeUrl+"?payload="+encodeURIComponent(JSON.stringify({custom:e})),type:R.CUSTOM,log:e,fail:function(e){"403 forbidden"===e&&h.destroy()}})}],R.CUSTOM)(e)}]),this.config=(n=this.config,void 0===(e=e.hostUrl)&&(e="https://aegis.qq.com"),n.url=n.url||e+"/collect",n.offlineUrl=n.offlineUrl||e+"/offline",n.whiteListUrl=n.whiteListUrl||e+"/collect/whitelist",n.pvUrl=n.pvUrl||e+"/collect/pv",n.eventUrl=n.eventUrl||e+"/collect/events",n.speedUrl=n.speedUrl||e+"/speed",n.customTimeUrl=n.customTimeUrl||e+"/speed/custom",n.performanceUrl=n.performanceUrl||e+"/speed/performance",n.webVitalsUrl=n.webVitalsUrl||e+"/speed/webvitals",n.setDataReportUrl=n.SetDataReportUrl||e+"/speed/miniProgramData",n),ee.instances.push(this)}(ke=j=j||{})[ke.unknown=100]="unknown",ke[ke.wifi=1]="wifi",ke[ke.net2g=2]="net2g",ke[ke.net3g=3]="net3g",ke[ke.net4g=4]="net4g",ke[ke.net5g=5]="net5g",ke[ke.net6g=6]="net6g",(qe=q=q||{})[qe.android=1]="android",qe[qe.ios=2]="ios",qe[qe.windows=3]="windows",qe[qe.macos=4]="macos",qe[qe.linux=5]="linux",qe[qe.other=100]="other";var te,ne,ie,oe,re,se,ae,ce,ue,le=new V({name:"device",onNewAegis:function(e){e.extendBean("platform",this.getPlatform()),e.extendBean("netType",j.unknown),this.getDpi(e),this.refreshNetworkTypeToBean(e)},getDpi:function(e){e.extendBean("vp",window.innerWidth+" * "+window.innerHeight),window.screen&&e.extendBean("sr",window.screen.width+" * "+window.screen.height)},getPlatform:function(){var e={android:/\bAndroid\s*([^;]+)/,ios:/\b(iPad|iPhone|iPod)\b.*? OS ([\d_]+)/,windows:/\b(Windows NT)/,macos:/\b(Mac OS)/,linux:/\b(Linux)/i},t=Object.keys(e).find((function(t){return e[t].test(navigator.userAgent)}));return t?q[t]:q.other},refreshNetworkTypeToBean:function(e){var t=this,n=e.config;n&&("function"==typeof n.getNetworkType?n.getNetworkType:fe)((function(n){j[n]||(n=j.unknown),e.extendBean("netType",n),t.NetworkRefreshTimer=setTimeout((function(){t.refreshNetworkTypeToBean(e),clearTimeout(t.NetworkRefreshTimer)}),1e4)}))}}),fe=function(e){var t="",n=navigator.userAgent.match(/NetType\/(\w+)/);n?t=n[1]:navigator.connection&&(t=navigator.connection.effectiveType||navigator.connection.type),e((t=t=t||"unknown",0<=(t=String(t).toLowerCase()).indexOf("4g")?j.net4g:0<=t.indexOf("wifi")?j.wifi:0<=t.indexOf("5g")?j.net5g:0<=t.indexOf("6g")?j.net6g:0<=t.indexOf("3g")?j.net3g:0<=t.indexOf("2g")?j.net2g:j.unknown))},de=new V({name:"onError"}),pe=de=new V({name:"onError",onNewAegis:function(e){this.startListen(e)},startListen:function(e){var i=this,t=window.onerror;function n(e){e=e&&T(e.reason),i.publishErrorLog({msg:"PROMISE_ERROR: "+e,level:E.PROMISE_ERROR})}function o(e){if(e=(null==e?void 0:e.target)||(null==e?void 0:e.srcElement)){var t=e.src||e.href;if(e=e.tagName,"string"==typeof t&&e){var n={msg:e+" load fail: "+t,level:E.INFO};switch(e.toLowerCase()){case"script":n.level=E.SCRIPT_ERROR;break;case"link":n.level=E.CSS_ERROR;break;case"img":if(-1<window.location.href.indexOf(t))return;n.level=E.IMAGE_ERROR;break;case"audio":case"video":n.level=E.MEDIA_ERROR;break;default:return}i.publishErrorLog(n)}}}window.onerror=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];i.publishErrorLog({msg:(T(e[0])||"")+" @ ("+(T(e[1])||"")+":"+(e[2]||0)+":"+(e[3]||0)+")\n          \n"+T(e[4]||""),level:E.ERROR}),null==t||t.call.apply(t,r([window],e))},window.addEventListener("unhandledrejection",n),window.document.addEventListener("error",o,!0),e.lifeCycle.on("destroy",(function(){0===de.countInstance()&&(window.document.removeEventListener("unhandledrejection",n),window.document.removeEventListener("error",o,!0))}));var s=this,c={name:this.name,send:function(i,t){i.addEventListener("loadend",(function(){var n,o,r="";this.failType?r=this.failType:this.status?400<=this.status&&(r="error"):r="failed",e.config.hostUrl&&this.aegisUrl&&-1<this.aegisUrl.indexOf(e.config.hostUrl)||(o=null===(n=e.config.api)||void 0===n?void 0:n.apiDetail,r&&(n=i.aegisUrl,n=y(i.response,e.config.api,{url:n,ctx:i}).code,s.publishErrorLog({msg:"AJAX_ERROR: request "+r+"\n                      \nres status: "+(this.status||0)+"\n                      \nres retcode: "+n+"\n                      \nres duration: "+(Date.now()-i.aegisXhrStartTime)+"\n                      \nreq url: "+this.aegisUrl+"\n                      \nreq method: "+this.aegisMethod+"\n                      \nreq param: "+(o?w(t):"")+"\n                      \nres data: "+(o?null===(o=(o=i).responseType&&"text"!==o.responseType?"":o.responseText)||void 0===o?void 0:o.slice(0,1e3):""),level:E.AJAX_ERROR})))})),i.addEventListener("timeout",(function(){i.failType="timeout"})),i.addEventListener("error",(function(){i.failType="error"})),i.addEventListener("abort",(function(){i.failType="abort"}))}};this.hackXHROptions=c,_(this.hackXHROptions)},publishErrorLog:function(e){this.$walk((function(t){t.normalLogPipeline(e)}))},destroy:function(){this.option.publishErrorLog=function(){},this.option.hackXHROptions&&U(this.option.hackXHROptions)}}),he=(new V({name:"pagePerformance"}),1),ge=new V({name:"pagePerformance",onNewAegis:function(i){var e=this;if(k())if(te)this.publish(te,i);else try{this.getFirstScreenTiming(i,(function(t){var n,o=performance.timing;o&&(n=o.loadEventStart-o.domInteractive,te={dnsLookup:o.domainLookupEnd-o.domainLookupStart,tcp:o.connectEnd-o.connectStart,ssl:0===o.secureConnectionStart?0:o.requestStart-o.secureConnectionStart,ttfb:o.responseStart-o.requestStart,contentDownload:o.responseEnd-o.responseStart,domParse:o.domInteractive-o.domLoading,resourceDownload:n=n<0?1070:n,firstScreenTiming:Math.floor(t)},e.publish(te,i))}))}catch(i){}},publish:function(e,s){var a=this;s.sendPipeline([function(e,t){var n,i=[];for(n in e)i.push(n+"="+e[n]);var o=a.$getConfig(s);if(o){var r=-1===s.config.performanceUrl.indexOf("?")?"?":"&";return"function"==typeof o.urlHandler?t({url:s.config.performanceUrl+r+i.join("&")+"&from="+(encodeURIComponent(o.urlHandler())||window.location.href),beanFilter:["from"],type:R.PERFORMANCE,log:e}):t({url:s.config.performanceUrl+r+i.join("&"),type:R.PERFORMANCE,log:e})}}],R.PERFORMANCE)(e)},getFirstScreenTiming:function(e,t){e.lifeCycle.on("destroy",(function(){r&&clearTimeout(r)}));var i=["script","style","link","br"],s=[],a=this,n={},u=new MutationObserver((function(e){var t={roots:[],rootsDomNum:[],time:performance.now()};e.forEach((function(e){e&&e.addedNodes&&e.addedNodes.forEach&&e.addedNodes.forEach((function(e){1===e.nodeType&&(e.hasAttribute("AEGIS-FIRST-SCREEN-TIMING")||e.querySelector("[AEGIS-FIRST-SCREEN-TIMING]"))?(Object.prototype.hasOwnProperty.apply(n,[t.time])||(n[t.time]=[]),n[t.time].push(e)):1!==e.nodeType||-1!==i.indexOf(e.nodeName.toLocaleLowerCase())||a.isEleInArray(e,t.roots)||e.hasAttribute("AEGIS-IGNORE-FIRST-SCREEN-TIMING")||(t.roots.push(e),t.rootsDomNum.push(a.walkAndCount(e)||0))}))})),t.roots.length&&s.push(t)}));u.observe(document,{childList:!0,subtree:!0});var o=function(){var c,i=0,l=0,f=Object.keys(n).filter((function(e){return n[+e].find((function(e){return a.isInFirstScreen(e)}))}));f.length?(l=Math.max.apply(null,f),("object"!=typeof(null===(f=e.config)||void 0===f?void 0:f.pagePerformance)||null!==(c=e.config.pagePerformance)&&void 0!==c&&c.firstScreenInfo)&&(e.firstScreenInfo={element:null===(c=n[l])||void 0===c?void 0:c[0],timing:l,markDoms:n})):s.forEach((function(t){for(var n,o=0;o<t.roots.length;o++)t.rootsDomNum[o]>i&&a.isInFirstScreen(t.roots[o])&&(i=t.rootsDomNum[o],l=t.time,("object"!=typeof(null===(n=e.config)||void 0===n?void 0:n.pagePerformance)||null!==(n=e.config.pagePerformance)&&void 0!==n&&n.firstScreenInfo)&&(e.firstScreenInfo={element:t.roots[o],timing:l}))})),!l&&he?r=setTimeout((function(){return o()}),3e3):(u.disconnect(),null==t||t(l)),--he},r=setTimeout((function(){return o()}),3e3)},isEleInArray:function(e,t){return!(!e||e===document.documentElement)&&(-1!==t.indexOf(e)||this.isEleInArray(e.parentElement,t))},isInFirstScreen:function(e){if(!e||"function"!=typeof e.getBoundingClientRect)return!1;var t=e.getBoundingClientRect(),n=window.innerHeight;return e=window.innerWidth,0<=t.left&&t.left<e&&0<=t.top&&t.top<n&&0<t.width&&0<t.height},walkAndCount:function(e){var t=0;if(e&&1===e.nodeType){t+=1;var n=e.children;if(null!=n&&n.length)for(var i=0;i<n.length;i++)t+=this.walkAndCount(n[i])}return t}});function ve(){re=[],ie=-1,ne=null,we(addEventListener)}function me(e,t){ne||(ne=t,ie=e,oe=new Date,we(removeEventListener),ye())}function ye(){var e;0<=ie&&ie<oe-ae&&(e={entryType:"first-input",name:ne.type,target:ne.target,cancelable:ne.cancelable,startTime:ne.timeStamp,processingStart:ne.timeStamp+ie},re.forEach((function(t){t(e)})),re=[])}function we(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,ce,se)}))}function be(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v1-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}}function Ee(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}}function Re(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)}function Oe(e,t,n){var i;return function(){0<=t.value&&(n||Ie.has(t)||"hidden"===document.visibilityState)&&(t.delta=t.value-(i||0),!t.delta&&void 0!==i||(i=t.value,e(t)))}}function Te(){Ce((function(e){e=e.timeStamp,Ae=e}),!0)}function Se(){return Ae<0&&((Ae=self.webVitals.firstHiddenTime)===1/0&&Te(),Re((function(){setTimeout((function(){Ae="hidden"===document.visibilityState?0:1/0,Te()}),0)}))),{get timeStamp(){return Ae}}}function Le(e){var t=e.name;e=e.value,Ne[t]=e}se={passive:!0,capture:!0},ae=new Date,ce=function(e){var t,n,i,o;function r(){me(n,i),o()}function s(){o()}e.cancelable&&(t=(1e12<e.timeStamp?new Date:performance.now())-e.timeStamp,"pointerdown"==e.type?(n=t,i=e,o=function(){removeEventListener("pointerup",r,se),removeEventListener("pointercancel",s,se)},addEventListener("pointerup",r,se),addEventListener("pointercancel",s,se)):me(t,e))},ue="hidden"===document.visibilityState?0:1/0,addEventListener("visibilitychange",(function e(t){"hidden"===document.visibilityState&&(ue=t.timeStamp,removeEventListener("visibilitychange",e,!0))}),!0),ve(),self.webVitals={firstInputPolyfill:function(e){re.push(e),ye()},resetFirstInputPolyfill:ve,get firstHiddenTime(){return ue}};var Pe,xe,Ce=function(e,t){function i(n){"pagehide"!==n.type&&"hidden"!==document.visibilityState||(e(n),t&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))}addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)},Ie=new("function"==typeof WeakSet?WeakSet:Set),Ae=-1,Ne=(new V({name:"webVitals"}),{FCP:-1,LCP:-1,FID:-1,CLS:-1}),ke=new V({name:"webVitals",onNewAegis:function(e){var t,i,n,o,s,a,r,u,c,l,f,p,d,g,h,v,m,y,b,w,E,R,O;if(k()&&"function"==typeof window.PerformanceObserver)try{y=Le,w=Se(),E=be("FCP"),R=performance.getEntriesByName("first-contentful-paint")[0],O=R?null:Ee("paint",P),(R||O)&&(b=Oe(y,E,void 0),R&&P(R),Re((function(e){E=be("FCP"),b=Oe(y,E,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){E.value=performance.now()-e.timeStamp,Ie.add(E),b()}))}))}))),p=Le,h=Se(),v=be("LCP"),(m=Ee("largest-contentful-paint",L))&&(d=Oe(p,v,void 0),g=function(){Ie.has(v)||(m.takeRecords().map(L),m.disconnect(),Ie.add(v),d())},["keydown","click"].forEach((function(e){addEventListener(e,g,{once:!0,capture:!0})})),Ce(g,!0),Re((function(e){v=be("LCP"),d=Oe(p,v,void 0),requestAnimationFrame((function(){requestAnimationFrame((function(){v.value=performance.now()-e.timeStamp,Ie.add(v),d()}))}))}))),r=Le,u=Se(),c=be("FID"),l=Ee("first-input",S),f=Oe(r,c,void 0),l&&Ce((function(){l.takeRecords().map(S),l.disconnect()}),!0),l||window.webVitals.firstInputPolyfill(S),Re((function(){c=be("FID"),f=Oe(r,c,void 0),window.webVitals.resetFirstInputPolyfill(),window.webVitals.firstInputPolyfill(S)})),n=Le,s=be("CLS",0),(a=Ee("layout-shift",T))&&(o=Oe(n,s,void 0),Ce((function(){a.takeRecords().map(T),o()})),Re((function(){s=be("CLS",0),o=Oe(n,s,void 0)}))),t=this.publish.bind(this,e),i=function(e){"pagehide"!==e.type&&"hidden"!==document.visibilityState||(t(e),removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0))},addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)}catch(e){}function T(e){e.hadRecentInput||(s.value+=e.value,s.entries.push(e),o())}function S(e){e.startTime<u.timeStamp&&(c.value=e.processingStart-e.startTime,c.entries.push(e),Ie.add(c),f())}function L(e){var t=e.startTime;t<h.timeStamp&&(v.value=t,v.entries.push(e)),d()}function P(e){"first-contentful-paint"===e.name&&(O&&O.disconnect(),e.startTime<w.timeStamp&&(E.value=e.startTime,E.entries.push(e),Ie.add(E),b()))}},publish:function(e){e.sendPipeline([function(t,n){var o,i=[];for(o in t)i.push(o+"="+t[o]);var r=-1===e.config.performanceUrl.indexOf("?")?"?":"&";n({url:e.config.webVitalsUrl+r+i.join("&"),type:R.VITALS,log:t,sendBeacon:!0})}],R.VITALS)(Ne)},destroy:function(){this.option.publish=function(){}}}),_e=0,Ue=(i(xe=Fe,qe=Pe=B),xe.prototype=null===qe?Object.create(qe):(De.prototype=qe.prototype,new De),Fe.prototype.getBean=function(e){var t=this;return void 0===e&&(e=[]),""+Object.getOwnPropertyNames(this.bean).filter((function(t){return-1===e.indexOf(t)})).map((function(e){return e+"="+t.bean[e]})).join("&")},Fe.prototype.resetRequesting=function(){this.requesting=!1;var e=this.requestQueue.shift();e&&this.request(e.options,e.success,e.fail)},Fe.prototype.request=function(e,t,n){var i=this;if(e&&"string"==typeof e.url&&""!==e.url&&this.bean.id)if(this.requesting)this.requestQueue.push({options:e,success:t,fail:n});else{this.requesting=!0;var o=e.url;!1!==e.addBean&&(o=o+(-1===o.indexOf("?")?"?":"&")+this.getBean(e.beanFilter)),e.url=o;var r=e.method||"get";if(!(e=(o=this.config.onBeforeRequest)?o(e,this):e))return this.resetRequesting(),console.log("Sending request blocked");if(!e.url)return this.resetRequesting(),console.warn("Please handle the parameters reasonably, options.url is necessary");if(navigator.sendBeacon&&e.sendBeacon)return this.resetRequesting(),navigator.sendBeacon(e.url,e.data);var s=new XMLHttpRequest;s.sendByAegis=!0,s.addEventListener("readystatechange",(function(){4===s.readyState&&(i.resetRequesting(),400<=s.status||0===s.status?null==n||n(s.response):null==t||t(s.response))})),"get"===r.toLocaleLowerCase()?(s.open("get",function(e,t){if("string"!=typeof e)return"";if("object"==typeof t&&t){var n=Object.getOwnPropertyNames(t).map((function(e){var n=t[e];return e+"="+("string"==typeof n?encodeURIComponent(n):encodeURIComponent(JSON.stringify(n)))})).join("&").replace(/eval/gi,"evaI");return e+(-1===e.indexOf("?")?"?":"&")+n}return e}(e.url,e.data)),s.send()):(s.open("post",e.url),e.contentType&&s.setRequestHeader("Content-Type",e.contentType),"string"==typeof e.data&&(e.data=e.data.replace(/eval/gi,"evaI")),s.send(e.data))}},Fe.useAsyncPlugin=function(s,e){var t,a=void 0===(t=(e=void 0===e?{}:e).exportsConstructor)?"aegis-plugin-"+_e:t,n=void 0===(t=e.onAegisInit)?function(){}:t,u=void 0===(e=e.onAegisInitAndPluginLoaded)?function(){}:e;if(_e+=1,"string"!=typeof s)throw new TypeError("useAsyncPlugin first param must be string");if("function"!=typeof n||"function"!=typeof u)throw new TypeError("onAegisInit and onAegisInitAndPluginLoaded must be function");this.use(new V({name:"asyncPlugin",onNewAegis:function(e){try{n(e),Fe.asyncPlugin[s]?u(e,window[Fe.asyncPlugin[s]]):(t=s,o=a,i=function(t){t||(Fe.asyncPlugin[s]=a,t=window[a],u(e,t))},r=document.createElement("script"),c=document.head,"function"==typeof o&&(i=o,o=""),r.src=t,r.setAttribute("name",o),r.name=o,r.setAttribute("crossorigin","anonymous"),r.crossorigin="anonymous",r.defer=!0,r.hasLoaded=!1,r.onreadystatechange=function(){r.hasLoaded||r.readyState&&"loaded"!==r.readyState&&"complete"!==r.readyState||(r.hasLoaded=!0,"function"==typeof i&&i(!1),setTimeout((function(){c.contains(r)&&c.removeChild(r)})))},r.onload=r.onreadystatechange,r.onerror=function(){"function"==typeof i&&i(!0),setTimeout((function(){c.contains(r)&&c.removeChild(r)}))},"complete"===document.readyState?c.appendChild(r):window.addEventListener("load",(function(){c.appendChild(r)})))}catch(t){console.log("error on below is caused by "+s+" "),console.error(t)}var t,o,i,r,c}}))},Fe.prototype.uploadLogs=function(e,t){this.lifeCycle.emit("uploadLogs",e=void 0===e?{}:e,t=void 0===t?{}:t)},Fe.sessionID="session-"+Date.now(),Fe.asyncPlugin={},Fe.urls={aegisCollect:"https://aegis.qq.com/collect",flog:"https://cdn-go.cn/vasdev/web_webpersistance_v2/v1.8.2/flog.core.min.js",shadowLog:""},Fe),je=new V({name:"offlineLog"}),qe=(B=je=new V({name:"offlineLog",onNewAegis:function(e){var t=Ue.urls.flog,n=e.config,g=[],r=null,c=null,l=function(e){c=e},d=function(e){g=g.concat(e)},b=function(e,t){r={conds:e=void 0===e?{}:e,params:t=void 0===t?{}:t}};Ue.useAsyncPlugin(t,{exportsConstructor:"Flog",onAegisInit:function(e){e.lifeCycle.on("beforeWrite",d),e.lifeCycle.on("uploadLogs",b),e.lifeCycle.on("onConfigChange",l)},onAegisInitAndPluginLoaded:function(i,e){var t,h,v,m,s,y=void 0===(a=n.dbConfig)?{}:a,w=void 0===(u=n.url)?Ue.urls.aegisCollect:u,O=n.offlineLogExp,S=void 0===O?3:O,a=n.id,u=n.uin;null===(O=i.lifeCycle)||void 0===O||O.remove("beforeWrite",d),null===(O=i.lifeCycle)||void 0===O||O.remove("uploadLogs",b),null===(O=i.lifeCycle)||void 0===O||O.remove("onConfigChange",l),y=Object.assign({lookupUrl:w+"/offlineAuto?id="+a,preservedDay:S,id:a,uin:u,aid:(null===(u=i.bean)||void 0===u?void 0:u.aid)||"",beforeRequest:i.config.beforeRequest,afterRequest:i.config.afterRequest},y,{sessionId:Ue.sessionID});try{var p=new e(y);g.forEach((function(e){p.add(o(o({},e),{level:e.level===E.INFO_ALL?E.INFO:e.level}))})),null===(t=i.lifeCycle)||void 0===t||t.on("beforeWrite",(function(e){(e=void 0===e?[]:e).forEach((function(e){p.add(o(o({},e),{level:e.level===E.INFO_ALL?E.INFO:e.level}))}))})),null===(h=i.lifeCycle)||void 0===h||h.on("uploadLogs",(function(e,t){var o;void 0===e&&(e={}),void 0===t&&(t={}),p.uploadLogs(Object.assign({id:n.id,uin:n.uin,aid:null===(o=i.bean)||void 0===o?void 0:o.aid},e),t)})),null===(v=i.lifeCycle)||void 0===v||v.on("onConfigChange",(function(e){p.setConfig(e)})),null===(m=i.lifeCycle)||void 0===m||m.on("destroy",(function(){0===je.countInstance()&&(g.length=0,"function"==typeof((r=null)==p?void 0:p.destroy)&&p.destroy())})),p.on("PERREVENT",(function(e){i.sendPipeline([function(e,t){var o=f({msg:T(e),level:E.INFO});t({type:R.OFFLINE,data:o,contentType:"application/x-www-form-urlencoded",method:"post",addBean:!1,url:n.url+"?id=893&sessionId="+Ue.sessionID+"&uin="+n.uin+"&from="+n.id+"&count=1&version=1.35.18",log:e})}],R.OFFLINE)(e)})),c&&(p.setConfig(c),c=null),r&&(null===(s=i.lifeCycle)||void 0===s||s.emit("uploadLogs",r.conds,r.params),r=null),i.flog=p}catch(i){console.log(i)}}})}}),new V({name:"spa"}),new V({name:"spa",init:function(){history.pushState=this.wr("pushState")||history.pushState,history.replaceState=this.wr("replaceState")||history.replaceState;var e=(null===(e=location.href)||void 0===e?void 0:e.split("?"))[0];this.$fireUrl=e,this.sendPv=this.sendPv.bind(this),this.onPageChange()},onPageChange:function(){window.addEventListener("replaceState",this.sendPv),window.addEventListener("pushState",this.sendPv),window.addEventListener("popstate",this.sendPv)},wr:function(e){var i=history[e];return"function"==typeof i&&!history.__hasWrittenByTamSpa&&(Object.defineProperty(history,"__hasWrittenByTamSpa",{value:!0,enumerable:!1}),function(){var t=i.apply(this,arguments),n=null;return"function"==typeof Event?n=new Event(e):(n=document.createEvent("HTMLEvents")).initEvent(e,!1,!0),window.dispatchEvent(n),t})},sendPv:function(){var e=this;setTimeout((function(){var t=location.href,n=(null===(n=location.href)||void 0===n?void 0:n.split("?"))[0];n&&n!==e.$fireUrl&&(e.$walk((function(e){e.send({url:e.config.pvUrl+"?from="+encodeURIComponent(t),beanFilter:["from"],type:R.WHITE_LIST})})),e.$fireUrl=n)}),0)},destroy:function(){window.removeEventListener("replaceState",this.option.sendPv),window.removeEventListener("pushState",this.option.sendPv),window.removeEventListener("popstate",this.option.sendPv)}}));function Fe(e){var t,n,i,r,c,s=Pe.call(this,e)||this;s.requestQueue=[],s.requesting=!1,s.speedLogPipeline=A([(r=s.config,c={},function(e,t){var n,i;r.speedSample?(i="object"==typeof r.repeat?r.repeat:{repeat:r.repeat},n=+i.speed||+i.repeat||5,Array.isArray(e)?(i=e.filter((function(e){var t=!c[e.url]||c[e.url]<n;return c[e.url]=1+~~c[e.url],t}))).length&&t(i):(!c[e.url]||c[e.url]<n)&&(c[e.url]=1+~~c[e.url],t(e))):t(e)}),P(s),(i=s,function(e,t){fe((function(n){i.extendBean("netType",n),t(e)}))}),function(e,t){s.lifeCycle.emit("beforeReportSpeed",e);var n=s.config.beforeReportSpeed;if((e="function"==typeof n?e.filter((function(e){var t,o,i=!1!==n(e);return"fetch"===e.type&&void 0===e.ret&&e.payload&&(t=(o=y(e.payload.data.response,s.config.api,{url:e.payload.data.url,ctx:e.payload.data})||{}).code,o=o.isErr,e.ret=t,e.isErr=+o),i})):e).length)return t(e)},function(e){return s.sendPipeline([function(e,t){var n,i,r,c;t({type:R.SPEED,url:""+s.config.speedUrl,method:"post",data:(n=e,i=s.bean,r={fetch:[],static:[]},c=new FormData,Array.isArray(n)?n.forEach((function(e){var t=X(e);r[e.type].push(t)})):(t=X(n),r[n.type].push(t)),c.append("payload",JSON.stringify(o({duration:r},i))),c),log:e})}],R.SPEED)(e)}]),e.asyncPlugin=!0;try{"undefined"!=typeof document&&(e.uin=e.uin||(null!==(t=document.cookie.match(/\buin=\D+(\d*)/))&&void 0!==t?t:[])[1]||(null!==(n=document.cookie.match(/\bilive_uin=\D*(\d+)/))&&void 0!==n?n:[])[1]||""),s.init(e),s.extendBean("sessionId",Fe.sessionID),s.extendBean("from",encodeURIComponent(e.pageUrl||location.href)),"undefined"!=typeof document&&s.extendBean("referer",encodeURIComponent(document.referrer||"")),e.ext1&&s.extendBean("ext1",e.ext1),e.ext2&&s.extendBean("ext2",e.ext2),e.ext3&&s.extendBean("ext3",e.ext3)}catch(e){console.warn(e),console.log("%cThe above error occurred in the process of initializing Aegis, which will affect your normal use of Aegis.\nIt is recommended that you contact us for feedback and thank you for your support.","color: red"),s.sendSDKError(e)}return s}function De(){this.constructor=xe}return new V({name:"ie"}),Ue.use(pe),Ue.use(z),Ue.use(J),Ue.use(ge),Ue.use(ke),Ue.use(W),Ue.use(le),Ue.use(B),Ue.use(qe),Ue}()}}]);